<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="驿氪数据会员报表">
    <meta name="keywords" content="from bootstrap and jquery">
    <meta name="author" content="Clark.King/from everyone">
    <title>驿氪数据会员报表</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="css/mylay.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <style>
        body {
            margin: 0;
            padding: 53px 0 0 0;
            width: 100%;
            height: 100%;
        }

        div.logins {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: block;
            background-color: black;
            z-index: 100;
            /* opacity: 0.5;
            filter:alpha(opacity=50); */
            background: rgba(0, 0, 0, 0.5);
        }

        div.mycode {
            margin: 90px auto;
            padding: 60px;
            width: 430px;
            background-color: #ace;
            border-radius: 14px;
        }

        ul.pagination {
            margin: 0;
        }
    </style>
</head>

<body>
     
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                
            </div>
        </div>
    </div>
    <div class="logins">
        <div class="mycode text-center">
            <h1>登陆</h1>
            <form class="innerform">
                <div class="form-group">
                    <label for="form_name" class="h4">用户名</label>
                    <input type="text" class="form-control" name="form_name" placeholder="手机号/用户名/邮箱">
                </div>
                <div class="form-group">
                    <label for="form_pwd" class="h4">密码</label>
                    <input type="password" class="form-control" name="form_pwd" placeholder="密码">
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="displaypwd"> 显示密码
                    </label>
                </div>
                <button type="button" id="loginsys" class="btn btn-default btn-block">登陆</button>
            </form>
        </div>
    </div>


    <div class="mainpage">
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">玛丽黛佳</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#Home">玛丽黛佳</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#vipreport">会员复购报表 <span class="sr-only">(current)</span></a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                aria-haspopup="true" aria-expanded="false">其他报表 <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#none">暂时还没有</a></li>

                            </ul>
                        </li>
                        <li class="active"><a href="#time" class="mytime"></a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                aria-haspopup="true" aria-expanded="false"><span id="usershow">用户</span> <span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#Exit">退出</a></li>

                            </ul>
                        </li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
        <div class="container">
            <div class="panel panel-primary">
                <div class="panel-heading"><span class="hdtitle">首页</span> </div>
                <div class="panel-body">
                    首页空白
                </div>
                <table class="table table-hover">
                    <thead></thead>
                    <tbody></tbody>
                </table>

                <div class="panel-footer">

                </div>
            </div>
        </div>
    </div>
    <script src="js/jqPaginator.js"></script>
    <script src="js/JsonExportExcel.min.js"></script>
    <script>
        var app = {
            getdate: function (num) {
                //关于日期
                var myDate = new Date();
                var yyyy = myDate.getFullYear();
                var mm = myDate.getMonth() + 1;
                var dd = myDate.getDate();
                var h = myDate.getHours();
                var m = myDate.getMinutes();
                var s = myDate.getSeconds();
                switch (num) {
                    case 0:
                        //当天 2019-02-18
                        mm = mm < 10 ? '0' + mm : mm;
                        dd = dd < 10 ? '0' + dd : dd;
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 1:
                        //此刻 14:11:15
                        h = h < 10 ? '0' + h : h;
                        m = m < 10 ? '0' + m : m;
                        s = s < 10 ? '0' + s : s;
                        return h + ':' + m + ':' + s;
                        break;
                    case 2:
                        //当月有几天 
                        var fristDay = new Date(yyyy, mm, 0);
                        dd = fristDay.getDate() < 10 ? '0' + fristDay.getDate() : fristDay.getDate();
                        return dd;
                        break;
                    case 3:
                        //当月第一天
                        mm = mm < 10 ? '0' + mm : mm;
                        var lastDay = new Date(yyyy, mm, 1);
                        dd = lastDay.getDate() < 10 ? '0' + lastDay.getDate() : lastDay.getDate();
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 4:
                        //当月最后一天
                        mm = mm < 10 ? '0' + mm : mm;
                        var fristDay = new Date(yyyy, mm, 0);
                        dd = fristDay.getDate() < 10 ? '0' + fristDay.getDate() : fristDay.getDate();
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 5:
                        //上月第一天
                        mm = mm - 1;
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy;
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);
                        var lastDay = new Date(yyyy, mm, 1);
                        dd = '0' + lastDay.getDate(); //获取第一天，所以不需要判断，直接0+1
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 6:
                        //上月最后一天
                        mm = mm - 1;
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy;
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);
                        var fristDay = new Date(yyyy, mm, 0);
                        dd = fristDay.getDate(); //获取最后一天，所以不需要加0前缀
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 7:
                        //最近七天

                        console.log('最近七天');
                        dd = dd - 7;
                        //console.log(dd);
                        mm = (dd < 1 ? mm = mm - 1 : mm); //当日期-7 产生负数，月份自动减1.
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy; //如果月份减1等于0，年份减1.
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);//月份等于0，自动变成12月份.
                        console.log(mm);
                        nday = this.getdate(8) + dd; //获取上月的天数+最近七天的差额
                        console.log(nday);
                        dd = (dd < 1 ? nday : ((dd < 10) ? '0' + dd : dd));
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 8:
                        //上月有几天
                        mm = mm - 1;
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy;
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);
                        var fristDay = new Date(yyyy, mm, 0);
                        dd = fristDay.getDate(); //获取最后一天，所以不需要加0前缀
                        return dd;
                        break;
                    case 11:
                        //昨天

                        console.log('昨天');
                        dd = dd - 1;
                        //console.log(dd);
                        mm = (dd < 1 ? mm = mm - 1 : mm); //当日期-7 产生负数，月份自动减1.
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy; //如果月份减1等于0，年份减1.
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);//月份等于0，自动变成12月份.
                        console.log(mm);
                        nday = this.getdate(8) + dd; //获取上月的天数+最近七天的差额
                        console.log(nday);
                        dd = (dd < 1 ? nday : ((dd < 10) ? '0' + dd : dd));
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 12:
                        //前天

                        console.log('前天');
                        dd = dd - 2;
                        //console.log(dd);
                        mm = (dd < 1 ? mm = mm - 1 : mm); //当日期-7 产生负数，月份自动减1.
                        yyyy = (mm == 0) ? (yyyy - 1) : yyyy; //如果月份减1等于0，年份减1.
                        mm = (mm == 0) ? '12' : ((mm < 10) ? '0' + mm : mm);//月份等于0，自动变成12月份.
                        console.log(mm);
                        nday = this.getdate(8) + dd; //获取上月的天数+最近七天的差额
                        console.log(nday);
                        dd = (dd < 1 ? nday : ((dd < 10) ? '0' + dd : dd));
                        ymd = yyyy + '-' + mm + '-' + dd;
                        return ymd;
                        break;
                    case 33:
                        mm = mm < 10 ? '0' + mm : mm;
                        dd = dd < 10 ? '0' + dd : dd;

                        h = h < 10 ? '0' + h : h;
                        m = m < 10 ? '0' + m : m;
                        s = s < 10 ? '0' + s : s;
                        return yyyy + mm + dd + h + m + s;
                        break;
                    default:
                        // 年月日时分秒2019-2-18 14:13:10 缺点 月份和日期不补零
                        return myDate.toLocaleString();
                        break;
                };

            },
            toajax: function (urls, codes, contents) {
                //关于 ajax
                let res = "";
                $.ajax({
                    type: "POST",
                    url: urls,
                    data: { "code": codes, "content": contents },
                    async: false,
                    //dataType: "json",
                    success: function (message, status) {
                        res = message;
                    },
                    error: function (message, status, errorThrown) { res = ({ "returnCode": 404, "returnMsg": "链接失败！" }) },
                    compile: function (message) { res = message }
                });
                return res;
            },
            log: function (log) {
                console.log(log);
            },
            Storage: {
                get: function (name) {
                    //获取key的值
                    return JSON.parse(localStorage.getItem(name));
                },
                set: function (name, val) {
                    //设置KEY value
                    localStorage.setItem(name, JSON.stringify(val));
                },
                add: function (name, addVal) {
                    //添加KEY的 value 的内容
                    var oldVal = this.get(name);
                    var newVal = oldVal.concat(addVal);
                    this.set(name, newVal);
                },
                rem: function (name) {
                    //删除指定的key
                    localStorage.removeItem(name);
                },
                cls: function () {
                    //删除所有的
                    localStorage.clear();
                }
            }
        }

        var comm = {
            pagination: function () {
                var conhtml = `<ul class="pagination leftpagin">
                        <li><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
                    </ul>`;
                conhtml += `<ul class="pagination rightpagin">
						<li class="showcols"><a>总600行</a></li>
						<li class="showpages"><a>共9页</a></li>
						<li class="showrows"><a>显示
							<select  id="selectshowrows">
								<option>10</option>
								<option>25</option>
								<option>50</option>
								<option>100</option>
							</select>
						行</a></li>
						<li class="showbtnchange"><a href="#tochangepage" >更改</a></li>						
						</ul>`;
                return conhtml;
            },
            setpage: function (hash) {
                switch (hash) {
                    case '#Home':
                        $('div.panel-body').html('首页空白');
                        $('table.table>thead').html('<tr>...</tr>');
                        $('table.table>tbody').html('<tr>...</tr>');
                        app.log(this["pagination"])
                        $('div.panel-footer').html(this.pagination);
                        break;
                    case '#vipreport':
                        var ys = ['2018', '2019', '2020'];
                        inputgp = `<form class="form-inline report">
                                    <div class="form-group">
                                        <label  for="timechs">时间选择器</label>
                                        <div class="input-group">
                                        <div class="input-group-addon">年份</div>
                                        <select class="form-control" id="xsj1" aria-describedby="add1">`;
                        for (let i = 0; i < ys.length; i++) {
                            inputgp += `<option>` + ys[i] + `</option>`;
                        }
                        inputgp += ` </select>
                                        <div class="input-group-addon">月份</div>
                                        <select class="form-control" id="xsj2" aria-describedby="add2">`;
                        for (let j = 1; j <= 12; j++) {
                            inputgp += j < 10 ? `<option>0` + j + `</option>` : `<option>` + j + `</option>`;
                        }
                        inputgp += ` </select> 
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="select">查询</button>
                                    <button type="button" class="btn btn-info"  id="download">下载</button>
                                    </form>`;

                        $('div.panel-body').html(inputgp);
                        $('table.table>thead').html('<tr>...</tr>');
                        $('table.table>tbody').html('<tr>...</tr>');

                        $('div.panel-footer').html(this.pagination());
                        break;
                }

            },
            pagemodel:function(cons){
                var conhtml ='';
                if (cons.titlename!=''){
                    conhtml+=`<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">`+cons.titlename+`</h4>
                    </div>`;
                }
                if (cons.body !=''){
                    conhtml+=`<div class="modal-body">`+cons.body+`</div>`;
                }
                
                if (cons.footer=='noDo'){
                    conhtml+=`<div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">确认</button>
                </div>`;
                }else if  (cons.footer=='noExit'){
                    conhtml+=`<div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>`;
                }
               
                
                return conhtml;

            }

        }
        var pwd = { 'wangyq': '123456', 'admin': '123456' };
        $(function () {
            setInterval(function () {
                var mytime = "现在时间：" + app.getdate(0) + ' ' + app.getdate(1);
                $('a.mytime').text(mytime);
            }, 1000);
            if (app.Storage.get('form_name')) {
                $('.logins').hide();
                $('#usershow').text(app.Storage.get('form_name'));
            }
            // 登陆进行处理--当前尚未校验
            $('#loginsys').on('click', function () {
                let contents = $("form.innerform").serializeArray();
                if (pwd[contents[0].value] == contents[1].value) {
                    app.Storage.set('form_name', contents[0].value, { expires: 0.1 });
                    app.Storage.set('form_pwd', contents[1].value, { expires: 0.1 });
                    window.location.reload();
                } else {
					var cons={
                        titlename:'提示框',
                        body:'用户名或者密码错！请重新输入！',
                        footer:'noExit'
                    };
					$('div.modal-content').html(comm.pagemodel(cons));
                    $('#myModal').modal('show')
                }

            });
            var res = "";
            $('a').on('click', function () {
                var hash = $(this)[0].hash;
                hash = hash == "" ? "#" : hash;
                var name = {
                    "#": "首页", "#none": "空白尚未做", "#vipreport": "会员复购报表"
                }
                $('span.hdtitle').text(name[hash])
                comm.setpage(hash)

                //    mylog(hash)
                switch (hash) {
                    case '#':
                        break;
                    case '#Home':
                        break;
                    case '#none':
                        break;
                    case '#Exit':
                        app.Storage.rem('form_name');
                        app.Storage.rem('form_pwd');
                        window.location.reload();
                        break;
                    case '#vipreport':
                        var cons = {
                            ys: $('#xsj1').val(),
                            ms: $('#xsj2').val()
                        };
                        $('#select').on('click', function () {
                            var cons={
                                titlename:'<div class="loading"><span></span><span></span><span></span><span></span><span></span></div>',
                                body:'',
                                footer:''
                            };
                            $('div.modal-content').html(comm.pagemodel(cons));
                            $('#myModal').modal('show');
                            res = app.toajax('php/ezrfind.php', 'ezrfind', cons);
                            rest = eval('(' + res + ')');
                            if (rest.returnCode == 0) {
                                var data = rest.returnContent;
                                setTimeout(function(){ $('#myModal').modal('hide'); }, 3000);
                        
                                
                                var result = [];
                                var nums = $('#selectshowrows').val();
                                for (let i = 0; i < data.length; i += parseInt(nums)) {
                                    result.push(data.slice(i, i + parseInt(nums)));
                                };

                                var rt = result[0];
                                let tableth = '<tr>'; //表列名
                                // 建立列信息
                                Object.keys(rt[0]).forEach(
                                    function (item, index) {
                                        tableth += '<th>' + item + '</th>';
                                    }
                                );
                                tableth += '</tr>';

                                let tabletds = new Array();

                                let rpage = result.length;
                                console.log(rpage)
                                for (let reslen = 0; reslen < rpage; reslen++) {
                                    let restd = result[reslen];
                                    let tabletd = ''; //表明细
                                    for (let ij = 0; ij < restd.length; ij++) {
                                        tabletd += '<tr>';
                                        let tds = restd[ij];
                                        Object.keys(tds).forEach(
                                            function (item, index) {
                                                tabletd += '<td>' + tds[item] + '</td>';
                                            }
                                        );
                                        tabletd += '</tr>';

                                    }
                                    tabletds.push(tabletd);
                                }


                                $('table.table>thead').html(tableth);
                                $('table.table>tbody').html(tabletds[0]);
                                $('.showcols>a').html('总' + data.length + '行');
                                $('.showpages>a').html('共' + rpage + '页');
                                $.jqPaginator('.leftpagin', {
                                    totalPages: parseInt(rpage),//总页数 
                                    visiblePages: 5,//同时显示li数
                                    currentPage: 1,//默认显示 第几页 
                                    prev: '<li class="prev"><a href="javascript:;"><</a></li>',
                                    next: '<li class="next"><a href="javascript:;">></a></li>',
                                    page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                                    onPageChange: function (num, type) {
                                        let tdsnum = num - 1;
                                        $('table.table>tbody').html(tabletds[tdsnum]);
                                    }
                                });
                                $('li.showbtnchange').on('click', function () {
                                    $('#select').click();
                                })
                            }
                        })
                        $('#download').on('click', function () {
                            
                            res = app.toajax('php/ezrfind.php', 'ezrfind', cons);
                            rest = eval('(' + res + ')');
                            if (rest.returnCode == 0) {
                                let rt = rest.returnContent;
                                let obj = rt[0];
                                let ths = [];
                                Object.keys(obj).forEach(function (key) {
                                    ths.push(key);
                                });

                                console.log(ths)
                                var option = {};
                                option.fileName = 'salevip' + app.getdate(33);
                                option.datas = [
                                    {
                                        sheetHeader: ths,
                                        sheetFilter: ths,
                                        sheetData: rt,
                                        sheetName: 'salevip1'
                                    }
                                ];
                                var toExcel = new ExportJsonExcel(option);
                                toExcel.saveExcel();
                            }
                        })
                        break;
                }

            });



        })
		//http://pos1.mariedalgar.com/myweb/ezrindex.html
    </script>
</body>

</html>